{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "combobox",
  "type": "registry:ui",
  "title": "Combobox",
  "description": "Combobox componet with wrapper",
  "registryDependencies": [
    "command",
    "popover",
    "button",
    "badge"
  ],
  "files": [
    {
      "path": "types/general.d.ts",
      "content": "type readOnlyChildren = Readonly<{\r\n  children: React.ReactNode;\r\n}>\r\n\r\ntype allowedPrimitiveT = string | number | boolean\r\n\r\ntype optionT = {\r\n  label: React.ReactNode\r\n  value: allowedPrimitiveT\r\n  className?: string\r\n}\r\n\r\ntype groupT = {\r\n  group: string\r\n  options: (allowedPrimitiveT | optionT)[]\r\n  className?: string\r\n}\r\n\r\ntype optionsT = (allowedPrimitiveT | optionT | groupT)[]\r\n\r\ntype indicatorAtT = \"right\" | \"left\"",
      "type": "registry:file",
      "target": "types/general.d.ts"
    },
    {
      "path": "lib/utils.ts",
      "content": "import { clsx, type ClassValue } from \"clsx\"\r\nimport { twMerge } from \"tailwind-merge\"\r\n\r\nexport function cn(...inputs: ClassValue[]) {\r\n  return twMerge(clsx(inputs))\r\n}\r\n\r\nexport function isAllowedPrimitive(value: unknown): value is allowedPrimitiveT {\r\n  return [\"string\", \"number\", \"boolean\"].includes(typeof value)\r\n}\r\n\r\nexport function parseAllowedPrimitive(value: allowedPrimitiveT): allowedPrimitiveT {\r\n  if (typeof value !== \"string\") return value\r\n\r\n  const trimmed = value.trim()\r\n\r\n  if (trimmed === \"true\") return true\r\n  if (trimmed === \"false\") return false\r\n  if (/^-?\\d+(\\.\\d+)?$/.test(trimmed)) return Number(trimmed)\r\n\r\n  return trimmed\r\n}\r\n\r\nexport function optionTypeChecker<T>(key: keyof T) {\r\n  return (option: any): option is T => !!option && typeof option === \"object\" && key in option\r\n}\r\n\r\nexport const isSeparator = (item: any) => item === \"---\"\r\nexport const isOption = optionTypeChecker<optionT>(\"value\")\r\nexport const isGroup = optionTypeChecker<groupT>(\"group\")\r\n\r\nexport const getValue = (item: allowedPrimitiveT | optionT) => typeof item === \"object\" ? item.value : item\r\nexport const getLabel = (item: allowedPrimitiveT | optionT) => typeof item === \"object\" ? item.label : `${item}`\r\n\r\nexport function getKey(item: allowedPrimitiveT | optionT, i: number): string {\r\n  const val = getValue(item)\r\n  if (typeof val === \"boolean\") return `key-${val}`\r\n  if (val === \"---\") return `${i}`\r\n  return `${val}`\r\n}",
      "type": "registry:lib"
    },
    {
      "path": "components/ui/combobox.tsx",
      "content": "\"use client\"\r\n\r\nimport { useState } from \"react\"\r\nimport { Check, ChevronsUpDown, Loader2, Plus } from \"lucide-react\"\r\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\r\n\r\nimport { cn, getKey, getLabel, getValue, isAllowedPrimitive, isGroup, isOption, isSeparator } from \"@/lib/utils\"\r\n\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n  CommandLoading,\r\n  CommandSeparator,\r\n} from \"@/components/ui/command\"\r\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Badge } from \"@/components/ui/badge\"\r\n\r\nconst extractText = (node: any): string => {\r\n  if (node === null || node === undefined) return \"\"\r\n  if (isAllowedPrimitive(node)) return String(node)\r\n  if (Array.isArray(node)) return node.map(extractText).join(\" \")\r\n  if (node.props?.children) return extractText(node.props.children)\r\n  return \"\"\r\n}\r\n\r\nconst findOptionByValue = (options: optionsT, value: allowedPrimitiveT) => {\r\n  for (const item of options) {\r\n    if (isGroup(item)) {\r\n      const found = item.options.find((opt) => getValue(opt) === value)\r\n      if (found) return found\r\n    } else if (!isSeparator(item) && getValue(item) === value) {\r\n      return item\r\n    }\r\n  }\r\n  return \"\"\r\n}\r\n\r\nconst filteredOptions = (options: optionsT, query: string): optionsT => {\r\n  const q = query.toLowerCase()\r\n  const result: optionsT = []\r\n\r\n  for (const item of options) {\r\n    if (isGroup(item)) {\r\n      const filtered = item.options.filter(opt =>\r\n        extractText(getLabel(opt)).toLowerCase().includes(q)\r\n      )\r\n      if (filtered.length) {\r\n        result.push({ ...item, options: filtered })\r\n      }\r\n      continue\r\n    }\r\n\r\n    if (isSeparator(item)) {\r\n      result.push(item)\r\n      continue\r\n    }\r\n\r\n    if (extractText(getLabel(item)).toLowerCase().includes(q)) {\r\n      result.push(item)\r\n    }\r\n  }\r\n\r\n  return result\r\n}\r\n\r\n\r\ntype ItemProps = {\r\n  option: allowedPrimitiveT | optionT\r\n  selected: boolean\r\n  className?: string\r\n  indicatorAt?: indicatorAtT\r\n  onSelect: (value: allowedPrimitiveT) => void\r\n}\r\n\r\nfunction Item({ option, selected, indicatorAt = \"right\", onSelect, className }: ItemProps) {\r\n  const value = getValue(option)\r\n  const label = getLabel(option)\r\n  const optCls = isOption(option) ? option.className : undefined\r\n\r\n  if (isSeparator(value)) return <CommandSeparator className={cn(\"my-0.5\", className, \"mx-0\")} />\r\n\r\n  return (\r\n    <CommandItem\r\n      value={`${value}`}\r\n      className={cn(indicatorAt === \"right\" ? \"pr-8 pl-2\" : \"pr-2 pl-8\", className, optCls)}\r\n      onSelect={() => onSelect(value)}\r\n    >\r\n      {label}\r\n\r\n      <Check\r\n        className={cn(\r\n          \"absolute size-4\",\r\n          selected ? \"opacity-100\" : \"opacity-0\",\r\n          indicatorAt === \"right\" ? \"right-2\" : \"left-2\",\r\n        )}\r\n      />\r\n    </CommandItem>\r\n  )\r\n}\r\n\r\ntype base = {\r\n  id?: string\r\n  options: optionsT\r\n  isLoading?: boolean\r\n  placeholder?: string\r\n  emptyMessage?: string\r\n\r\n  indicatorAt?: indicatorAtT\r\n  triggerCls?: string\r\n  contentCls?: string\r\n  groupCls?: string\r\n  itemCls?: string\r\n  matchTriggerWidth?: boolean\r\n\r\n  open?: boolean\r\n  onOpenChange?: (v: boolean) => void\r\n  query?: string\r\n  onQueryChange?: (v: string) => void\r\n\r\n  popoverContentProps?: Omit<React.ComponentProps<typeof PopoverPrimitive.Content>, \"className\">\r\n}\r\n\r\ntype comboboxProps = base & {\r\n  value?: allowedPrimitiveT\r\n  canCreateNew?: boolean\r\n  onValueChange?: (value: allowedPrimitiveT) => void\r\n}\r\n\r\nfunction Combobox({\r\n  id,\r\n  options = [],\r\n  isLoading,\r\n  placeholder,\r\n  emptyMessage,\r\n  canCreateNew,\r\n\r\n  matchTriggerWidth = true,\r\n  indicatorAt,\r\n  triggerCls,\r\n  contentCls,\r\n  groupCls,\r\n  itemCls,\r\n\r\n  value: o_value,\r\n  onValueChange: o_onValueChange,\r\n\r\n  query: o_query,\r\n  onQueryChange: o_onQueryChange,\r\n\r\n  open: o_open,\r\n  onOpenChange: o_onOpenChange,\r\n\r\n  popoverContentProps,\r\n}: comboboxProps) {\r\n  const [i_value, setIValue] = useState(\"\")\r\n  const [i_query, setIQuery] = useState(\"\")\r\n  const [i_open, setIOpen] = useState(false)\r\n\r\n  const value = o_value ?? i_value\r\n  const query = o_query ?? i_query\r\n  const open = o_open ?? i_open\r\n\r\n  const onValueChange = o_onValueChange ?? setIValue\r\n  const onQueryChange = o_onQueryChange ?? setIQuery\r\n  const onOpenChange = o_onOpenChange ?? setIOpen\r\n\r\n  const selectedOption = findOptionByValue(options, value)\r\n  const filtered = filteredOptions(options, query)\r\n  const label = getLabel(selectedOption)\r\n\r\n  const showCreate =\r\n    canCreateNew &&\r\n    query &&\r\n    !options.some((o) =>\r\n      isGroup(o)\r\n        ? o.options.some((x) => extractText(getLabel(x)) === query)\r\n        : extractText(getLabel(o)) === query\r\n    )\r\n\r\n  function onSelect(v: allowedPrimitiveT) {\r\n    onValueChange(v as string)\r\n    onOpenChange(false)\r\n  }\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={onOpenChange}>\r\n      <PopoverTrigger asChild>\r\n        <Button\r\n          id={id}\r\n          role=\"combobox\"\r\n          variant=\"outline\"\r\n          className={cn(\"font-normal\", triggerCls, {\r\n            \"text-muted-foreground\": !value && value !== false,\r\n          })}\r\n        >\r\n          {isLoading ? (\r\n            <>\r\n              <Loader2 className=\"size-4 animate-spin\" />\r\n              Loading...\r\n            </>\r\n          ) :\r\n            <span className=\"flex items-center gap-2 truncate\">\r\n              {\r\n                (selectedOption || selectedOption === false)\r\n                  ? label\r\n                  : placeholder\r\n              }\r\n            </span>\r\n          }\r\n\r\n          <ChevronsUpDown className=\"ml-auto size-4 opacity-50\" />\r\n        </Button>\r\n      </PopoverTrigger>\r\n\r\n      <PopoverContent\r\n        {...popoverContentProps}\r\n        className={cn(\"p-0\", matchTriggerWidth && \"w-[var(--radix-popover-trigger-width)]\", contentCls)}\r\n      >\r\n        <Command shouldFilter={false}>\r\n          {\r\n            !isLoading &&\r\n            <CommandInput\r\n              placeholder=\"Search...\"\r\n              value={query}\r\n              onValueChange={onQueryChange}\r\n            />\r\n          }\r\n\r\n          <CommandList className=\"py-1\">\r\n            {\r\n              isLoading &&\r\n              <CommandLoading>\r\n                <span className=\"flex items-center justify-center gap-2\">\r\n                  <Loader2 className=\"animate-spin size-4\" /> Loading...\r\n                </span>\r\n              </CommandLoading>\r\n            }\r\n\r\n            {\r\n              !isLoading &&\r\n              <CommandEmpty>{emptyMessage || \"No options found\"}</CommandEmpty>\r\n            }\r\n\r\n            {!isLoading && filtered.map((item, i) => {\r\n              if (isGroup(item)) {\r\n                return (\r\n                  <CommandGroup\r\n                    key={item.group}\r\n                    heading={item.group}\r\n                    className={cn(\"[&_[cmdk-group-heading]]:pb-0.5\", groupCls, item.className)}\r\n                  >\r\n                    {item.options.map((opt, j) => (\r\n                      <Item\r\n                        key={getKey(opt, j)}\r\n                        option={opt}\r\n                        selected={getValue(opt) === value}\r\n                        onSelect={onSelect}\r\n                        className={itemCls}\r\n                        indicatorAt={indicatorAt}\r\n                      />\r\n                    ))}\r\n                  </CommandGroup>\r\n                )\r\n              }\r\n\r\n              return (\r\n                <Item\r\n                  key={getKey(item, i)}\r\n                  option={item}\r\n                  selected={getValue(item) === value}\r\n                  onSelect={onSelect}\r\n                  indicatorAt={indicatorAt}\r\n                  className={cn(\"mx-1\", itemCls)}\r\n                />\r\n              )\r\n            })}\r\n\r\n            {showCreate && (\r\n              <CommandGroup>\r\n                <CommandItem\r\n                  value={`__create-${query}`}\r\n                  onSelect={() => {\r\n                    onValueChange(query)\r\n                    onQueryChange(\"\")\r\n                    onOpenChange(false)\r\n                  }}\r\n                >\r\n                  <Plus className=\"mr-2 h-4 w-4\" /> Create: {query}\r\n                </CommandItem>\r\n              </CommandGroup>\r\n            )}\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  )\r\n}\r\n\r\ntype btnLableProps = {\r\n  value: allowedPrimitiveT[]\r\n  options: optionsT\r\n  isLoading?: boolean\r\n  placeholder?: string\r\n  maxVisibleCount?: number\r\n}\r\nfunction ButtonLabel({\r\n  value,\r\n  options,\r\n  isLoading,\r\n  placeholder,\r\n  maxVisibleCount = 2,\r\n}: btnLableProps) {\r\n  const labelOf = (val: allowedPrimitiveT) => {\r\n    const found = findOptionByValue(options, val)\r\n    if (!found) return `${val}`\r\n    const label = getLabel(found)\r\n    return label\r\n  }\r\n\r\n  if (isLoading)\r\n    return (\r\n      <>\r\n        <Loader2 className=\"size-4 animate-spin\" />\r\n        Loading...\r\n      </>\r\n    )\r\n\r\n  if (value.length === 0) {\r\n    return placeholder\r\n  }\r\n\r\n  if (value.length <= maxVisibleCount) {\r\n    return (\r\n      <>\r\n        {value.map((v) => (\r\n          <Badge key={String(v)} variant=\"secondary\" className=\"rounded-sm px-1 font-normal\">\r\n            {labelOf(v)}\r\n          </Badge>\r\n        ))}\r\n      </>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Badge variant=\"secondary\" className=\"rounded-sm px-1 font-normal\">\r\n      {value.length} selected\r\n    </Badge>\r\n  )\r\n}\r\n\r\ntype multiSelectComboboxProps = base & {\r\n  value?: allowedPrimitiveT[]\r\n  maxVisibleCount?: number\r\n  label?: React.ReactNode\r\n  onValueChange?: (v: allowedPrimitiveT[]) => void\r\n}\r\n\r\nfunction MultiSelectCombobox({\r\n  id,\r\n  options = [],\r\n  isLoading,\r\n  placeholder,\r\n  emptyMessage,\r\n\r\n  matchTriggerWidth = true,\r\n  maxVisibleCount,\r\n  indicatorAt,\r\n  triggerCls,\r\n  contentCls,\r\n  groupCls,\r\n  itemCls,\r\n  label,\r\n\r\n  value: o_value,\r\n  onValueChange: o_onValueChange,\r\n\r\n  query: o_query,\r\n  onQueryChange: o_onQueryChange,\r\n\r\n  open: o_open,\r\n  onOpenChange: o_onOpenChange,\r\n  popoverContentProps,\r\n}: multiSelectComboboxProps) {\r\n  const [i_value, setIValue] = useState<allowedPrimitiveT[]>([])\r\n  const [i_query, setIQuery] = useState(\"\")\r\n  const [i_open, setIOpen] = useState(false)\r\n\r\n  const value = o_value ?? i_value\r\n  const query = o_query ?? i_query\r\n  const open = o_open ?? i_open\r\n\r\n  const onValueChange = o_onValueChange ?? setIValue\r\n  const onQueryChange = o_onQueryChange ?? setIQuery\r\n  const onOpenChange = o_onOpenChange ?? setIOpen\r\n\r\n  const filtered = filteredOptions(options, query)\r\n\r\n  const onSelect = (v: allowedPrimitiveT) => {\r\n    onValueChange(value.includes(v) ? value.filter((x) => x !== v) : [...value, v])\r\n  }\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={onOpenChange}>\r\n      <PopoverTrigger asChild>\r\n        <Button\r\n          id={id}\r\n          role=\"combobox\"\r\n          variant=\"outline\"\r\n          aria-expanded={open}\r\n          className={cn(\"font-normal\", triggerCls, {\r\n            \"text-muted-foreground\": value.length === 0,\r\n          })}\r\n        >\r\n          {label}\r\n\r\n          <ButtonLabel\r\n            value={value}\r\n            options={options}\r\n            isLoading={isLoading}\r\n            placeholder={placeholder}\r\n            maxVisibleCount={maxVisibleCount}\r\n          />\r\n\r\n          <ChevronsUpDown className=\"ml-auto size-4 opacity-50\" />\r\n        </Button>\r\n      </PopoverTrigger>\r\n\r\n      <PopoverContent\r\n        {...popoverContentProps}\r\n        className={cn(\"p-0\", matchTriggerWidth && \"w-[var(--radix-popover-trigger-width)]\", contentCls)}\r\n      >\r\n        <Command shouldFilter={false}>\r\n          {\r\n            !isLoading &&\r\n            <CommandInput\r\n              placeholder=\"Search...\"\r\n              value={query}\r\n              onValueChange={onQueryChange}\r\n            />\r\n          }\r\n\r\n          <CommandList className=\"py-1\">\r\n            {\r\n              isLoading &&\r\n              <CommandLoading>\r\n                <span className=\"flex items-center justify-center gap-2\">\r\n                  <Loader2 className=\"animate-spin size-4\" /> Loading...\r\n                </span>\r\n              </CommandLoading>\r\n            }\r\n\r\n            {\r\n              !isLoading &&\r\n              <CommandEmpty>{emptyMessage || \"No options found\"}</CommandEmpty>\r\n            }\r\n\r\n            {!isLoading && filtered.map((item, i) => {\r\n              if (isGroup(item)) {\r\n                return (\r\n                  <CommandGroup\r\n                    key={item.group}\r\n                    heading={item.group}\r\n                    className={cn(\"[&_[cmdk-group-heading]]:pb-0.5\", groupCls, item.className)}\r\n                  >\r\n                    {item.options.map((opt, j) => (\r\n                      <Item\r\n                        key={getKey(opt, j)}\r\n                        option={opt}\r\n                        selected={value.includes(getValue(opt))}\r\n                        onSelect={onSelect}\r\n                        indicatorAt={indicatorAt}\r\n                        className={itemCls}\r\n                      />\r\n                    ))}\r\n                  </CommandGroup>\r\n                )\r\n              }\r\n\r\n              return (\r\n                <Item\r\n                  key={getKey(item, i)}\r\n                  option={item}\r\n                  selected={value.includes(getValue(item))}\r\n                  onSelect={onSelect}\r\n                  indicatorAt={indicatorAt}\r\n                  className={cn(\"mx-1 mb-1\", itemCls)}\r\n                />\r\n              )\r\n            })}\r\n\r\n            {value.length > 0 && (\r\n              <>\r\n                <CommandSeparator />\r\n                <CommandGroup>\r\n                  <CommandItem onSelect={() => onValueChange([])} value=\"__clear__\" className=\"justify-center\">\r\n                    Clear selection(s)\r\n                  </CommandItem>\r\n                </CommandGroup>\r\n              </>\r\n            )}\r\n          </CommandList>\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  )\r\n}\r\n\r\nexport {\r\n  Combobox,\r\n  MultiSelectCombobox,\r\n  type comboboxProps,\r\n  type multiSelectComboboxProps,\r\n}",
      "type": "registry:ui"
    }
  ]
}